!function(i,t,e){"use strict";var s,n,o=i.event;s=o.special.debouncedresize={setup:function(){i(this).on("resize",s.handler)},teardown:function(){i(this).off("resize",s.handler)},handler:function(i,t){var e=this,a=arguments,r=function(){i.type="debouncedresize",o.dispatch.apply(e,a)};n&&clearTimeout(n),t?r():n=setTimeout(r,s.threshold)},threshold:150};var a="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";i.fn.imagesLoaded=function(t){function s(){var e=i(d),s=i(m);r&&(m.length?r.reject(p,e,s):r.resolve(p)),i.isFunction(t)&&t.call(o,p,e,s)}function n(t,e){t.src!==a&&i.inArray(t,h)===-1&&(h.push(t),e?m.push(t):d.push(t),i.data(t,"imagesLoaded",{isBroken:e,src:t.src}),l&&r.notifyWith(i(t),[e,p,i(d),i(m)]),p.length===h.length&&(setTimeout(s),p.unbind(".imagesLoaded")))}var o=this,r=i.isFunction(i.Deferred)?i.Deferred():0,l=i.isFunction(r.notify),p=o.find("img").add(o.filter("img")),h=[],d=[],m=[];return i.isPlainObject(t)&&i.each(t,function(i,e){"callback"===i?t=e:r&&r[i](e)}),p.length?p.bind("load.imagesLoaded error.imagesLoaded",function(i){n(i.target,"error"===i.type)}).each(function(t,s){var o=s.src,r=i.data(s,"imagesLoaded");return r&&r.src===o?void n(s,r.isBroken):s.complete&&s.naturalWidth!==e?void n(s,0===s.naturalWidth||0===s.naturalHeight):void((s.readyState||s.complete)&&(s.src=a,s.src=o))}):s(),r?r.promise(o):o};var r=i(t),l=t.Modernizr;i.Stapel=function(t,e){this.el=i(e),this._init(t)},i.Stapel.defaults={gutter:40,pileAngles:2,pileAnimation:{openSpeed:400,openEasing:"ease-in-out",closeSpeed:400,closeEasing:"ease-in-out"},otherPileAnimation:{openSpeed:400,openEasing:"ease-in-out",closeSpeed:350,closeEasing:"ease-in-out"},delay:0,randomAngle:!1,onLoad:function(){return!1},onBeforeOpen:function(i){return!1},onAfterOpen:function(i,t){return!1},onBeforeClose:function(i){return!1},onAfterClose:function(i,t){return!1}},i.Stapel.prototype={_init:function(t){this.options=i.extend(!0,{},i.Stapel.defaults,t),this._config();var e=this;this.el.imagesLoaded(function(){e.options.onLoad(),e._layout(),e._initEvents()})},_config:function(){this.support=l.csstransitions;var t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},e={WebkitTransform:"-webkit-transform",MozTransform:"-moz-transform",OTransform:"-o-transform",msTransform:"-ms-transform",transform:"transform"};this.support&&(this.transEndEventName=t[l.prefixed("transition")]+".cbpFWSlider",this.transformName=e[l.prefixed("transform")]),this.spread=!1,this.items=this.el.children("li").hide(),this.close=i("#tp-close")},_getSize:function(){this.elWidth=this.el.outerWidth(!0)},_initEvents:function(){var t=this;r.on("debouncedresize.stapel",function(){t._resize()}),this.items.on("click.stapel",function(){var e=i(this);if(!t.spread&&e.data("isPile"))return t.spread=!0,t.pileName=e.data("pileName"),t.options.onBeforeOpen(t.pileName),t._openPile(),!1})},_layout:function(){this._piles(),this.itemSize={width:this.items.outerWidth(!0),height:this.items.outerHeight(!0)},this.items.remove(),this._setInitialStyle(),this.el.css("min-width",this.itemSize.width+this.options.gutter),this._getSize(),this._setItemsPosition(),this.items=this.el.children("li").show(),this.itemsCount=this.items.length},_piles:function(){this.piles={};var t,e=this,s=0;this.items.each(function(){for(var n=i(this),o=n.attr("data-pile")||"nopile-"+n.index(),a=o.split(","),r=0,l=a.length;r<l;++r){var p=i.trim(a[r]);t=e.piles[p],t||(t=e.piles[p]={elements:[],position:{left:0,top:0},index:s},++s);var h=n.clone().get(0);t.elements.push({el:h,finalPosition:{left:0,top:0}}),i(h).appendTo(e.el)}})},_setInitialStyle:function(){for(var t in this.piles)for(var e=this.piles[t],s=0,n=e.elements.length;s<n;++s){var o=i(e.elements[s].el),a={transform:"rotate(0deg)"};if(this._applyInitialTransition(o),s===n-2)a={transform:"rotate("+this.options.pileAngles+"deg)"};else if(s===n-3)a={transform:"rotate(-"+this.options.pileAngles+"deg)"};else if(s!==n-1){var r={visibility:"hidden"};o.css(r).data("extraStyle",r)}else"nopile"!==t.substr(0,6)&&o.data("front",!0).append('<div class="tp-title"><span>'+t+"</span><span>"+n+"</span></div>");o.css(a).data({initialStyle:a,pileName:t,pileCount:n,shadow:o.css("box-shadow"),isPile:"nopile"!==t.substr(0,6)})}},_applyInitialTransition:function(i){this.support&&i.css("transition","left 400ms ease-in-out, top 400ms ease-in-out")},_setItemsPosition:function(){var t,e,s=0,n=0,o=0,a=0;for(var r in this.piles){var l,p,h=this.piles[r],d=this.itemSize.width+this.options.gutter,m=0,c=0;s+d<=this.elWidth?(t=s,e=n,s+=d):(0===o&&(o=Math.ceil((this.elWidth-s+this.options.gutter)/2)),n+=this.itemSize.height+this.options.gutter,t=0,e=n,s=d),h.position.left=t,h.position.top=e;for(var f=0,u=h.elements.length;f<u;++f){var v=h.elements[f],g=v.finalPosition;m+d<=this.elWidth?(l=m,p=c,m+=d):(c+=this.itemSize.height+this.options.gutter,l=0,p=c,m=d),g.left=l,g.top=p;var A=i(v.el);r!==this.pileName?A.css({left:h.position.left,top:h.position.top}):(a=v.finalPosition.top,A.css({left:v.finalPosition.left,top:a}))}}a=this.spread?a:n,this.el.css({marginLeft:o,height:a+this.itemSize.height})},_openPile:function(){if(!this.spread)return!1;var t;for(var e in this.piles)for(var s=this.piles[e],n=0,o=0,a=s.elements.length;o<a;++o){var r=s.elements[o],l=i(r.el),p=l.find("img"),h=e===this.pileName?{zIndex:9999,visibility:"visible",transition:this.support?"left "+this.options.pileAnimation.openSpeed+"ms "+(a-o-1)*this.options.delay+"ms "+this.options.pileAnimation.openEasing+", top "+this.options.pileAnimation.openSpeed+"ms "+(a-o-1)*this.options.delay+"ms "+this.options.pileAnimation.openEasing+", "+this.transformName+" "+this.options.pileAnimation.openSpeed+"ms "+(a-o-1)*this.options.delay+"ms "+this.options.pileAnimation.openEasing:"none"}:{zIndex:1,transition:this.support?"opacity "+this.options.otherPileAnimation.closeSpeed+"ms "+this.options.otherPileAnimation.closeEasing:"none"};e===this.pileName?(l.data("front")&&l.find("div.tp-title").hide(),o<a-1&&p.css("visibility","visible"),t=r.finalPosition,t.transform=this.options.randomAngle&&o!==s.index?"rotate("+Math.floor(11*Math.random()-5)+"deg)":"none",this.support||l.css("transform","none"),o<a-3&&l.css("box-shadow","none")):o<a-1&&p.css("visibility","hidden"),l.css(h);var d=this;e===this.pileName?this._applyTransition(l,t,this.options.pileAnimation.openSpeed,function(t){var e=this.target||this.nodeName;if("LI"===e){var s=i(this);s.css("box-shadow",s.data("shadow")),d.support&&s.off(d.transEndEventName),++n,n===s.data("pileCount")&&(i(document).one("mousemove.stapel",function(){d.el.addClass("tp-open")}),d.options.onAfterOpen(d.pileName,n))}}):this._applyTransition(l,{opacity:0},this.options.otherPileAnimation.closeSpeed)}this.el.css("height",t.top+this.itemSize.height)},_closePile:function(){var t=this;if(this.spread){this.spread=!1,this.options.onBeforeClose(this.pileName),this.el.removeClass("tp-open");var e;for(var s in this.piles)for(var n=this.piles[s],o=0,a=0,r=n.elements.length;a<r;++a){var l=i(n.elements[a].el),p=s===this.pileName?{transition:this.support?"left "+this.options.pileAnimation.closeSpeed+"ms "+this.options.pileAnimation.closeEasing+", top "+this.options.pileAnimation.closeSpeed+"ms "+this.options.pileAnimation.closeEasing+", "+this.transformName+" "+this.options.pileAnimation.closeSpeed+"ms "+this.options.pileAnimation.closeEasing:"none"}:{transition:this.support?"opacity "+this.options.otherPileAnimation.openSpeed+"ms "+this.options.otherPileAnimation.openEasing:"none"};l.css(p),e=n.position,s===this.pileName&&(i.extend(e,l.data("initialStyle")),a<r-3&&l.css("box-shadow","none")),s===this.pileName?this._applyTransition(l,e,this.options.pileAnimation.closeSpeed,function(e){var s=this.target||this.nodeName;if("LI"===s){var n=i(this),a=n.data("extraStyle");n.css("box-shadow",n.data("shadow")),t.support?(n.off(t.transEndEventName),t._applyInitialTransition(n)):n.css(n.data("initialStyle")),a&&n.css(a),++o,n.data("front")&&n.find("div.tp-title").show(),o===n.data("pileCount")&&t.options.onAfterClose(n.data("pileName"),o)}}):this._applyTransition(l,{opacity:1},this.options.otherPileAnimation.openSpeed,function(e){var s=this.target||this.nodeName;if("LI"===s){var n=i(this);n.index()<r-1&&n.find("img").css("visibility","visible"),t.support&&(n.off(t.transEndEventName),t._applyInitialTransition(n))}})}this.pileName="",this.el.css("height",e.top+this.itemSize.height)}return!1},_resize:function(){this._getSize(),this._setItemsPosition()},_applyTransition:function(t,e,s,n){i.fn.applyStyle=this.support?i.fn.css:i.fn.animate,n&&this.support&&t.on(this.transEndEventName,n),n=n||function(){return!1},t.stop().applyStyle(e,i.extend(!0,[],{duration:s+"ms",complete:n}))},closePile:function(){this._closePile()}};var p=function(i){t.console&&t.console.error(i)};i.fn.stapel=function(t){var e=i.data(this,"stapel");if("string"==typeof t){var s=Array.prototype.slice.call(arguments,1);this.each(function(){return e?i.isFunction(e[t])&&"_"!==t.charAt(0)?void e[t].apply(e,s):void p("no such method '"+t+"' for stapel instance"):void p("cannot call methods on stapel prior to initialization; attempted to call method '"+t+"'")})}else this.each(function(){e?e._init():e=i.data(this,"stapel",new i.Stapel(t,this))});return e}}(jQuery,window);